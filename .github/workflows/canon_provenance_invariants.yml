name: Canon Provenance Invariants

on:
  push:
    branches: [ main ]
  pull_request:

jobs:
  provenance-invariants:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Assert no Canon imports or writes
        run: |
          python - << 'EOF'
          import pathlib

          forbidden = pathlib.Path("lifeos/provenance").rglob("*.py")
          for f in forbidden:
            text = f.read_text(encoding="utf-8")
            if "lifeos.canon" in text:
              raise SystemExit(f"Forbidden Canon import in {f}")

          print("No Canon imports detected.")
          EOF
